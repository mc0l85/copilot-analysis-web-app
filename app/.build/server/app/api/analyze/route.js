"use strict";(()=>{var e={};e.id=652,e.ids=[652],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},2212:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>$,requestAsyncStorage:()=>D,routeModule:()=>v,serverHooks:()=>O,staticGenerationAsyncStorage:()=>A});var o={};r.r(o),r.d(o,{POST:()=>b});var a=r(9303),s=r(8716),n=r(670),i=r(7070),l=r(629);let c=require("child_process");var u=r(5315),h=r.n(u);let p=require("crypto"),d={randomUUID:p.randomUUID},m=new Uint8Array(256),f=m.length,g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));let y=function(e,t,r){if(d.randomUUID&&!t&&!e)return d.randomUUID();let o=(e=e||{}).random??e.rng?.()??(f>m.length-16&&((0,p.randomFillSync)(m),f=0),m.slice(f,f+=16));if(o.length<16)throw Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(o)};var w=r(9460);let S=e=>e&&"object"==typeof e&&"function"==typeof e.arrayBuffer,M=e=>{try{let t=e.trim();if(!t)throw Error("Empty string provided for JSON parsing");if(!t.startsWith("{")&&!t.startsWith("["))throw Error(`Invalid JSON format. Text starts with: "${t.substring(0,20)}..."`);return JSON.parse(t)}catch(t){throw Error(`JSON parsing failed: ${t instanceof Error?t.message:"Unknown error"}. Input: "${e.substring(0,100)}..."`)}};async function b(e){try{let t=await e.formData(),r=y(),o=h().join(process.cwd(),"temp",r);await (0,l.mkdir)(o,{recursive:!0});let a=t.get("targetUsersFile"),s=JSON.parse(t.get("filters")||"{}"),n=[],u=[],p="";if(a&&S(a)&&(a.size||0)>0){let e=Buffer.from(await a.arrayBuffer());p=h().join(o,"target_users.csv"),await (0,l.writeFile)(p,e),n.push(p)}let d=[];for(let[e,r]of t.entries())e.startsWith("usageReportFile_")&&S(r)&&d.push(r);for(let e=0;e<d.length;e++){let t=d[e],r=Buffer.from(await t.arrayBuffer()),a=t.name?.split(".").pop()||"csv",s=h().join(o,`usage_report_${e}.${a}`);await (0,l.writeFile)(s,r),u.push(s),n.push(s)}let m=h().join(o,"output");await (0,l.mkdir)(m,{recursive:!0});let f=[h().join(process.cwd(),"python_backend","copilot_analyzer.py"),"--usage-reports",...u,"--output-dir",m];p&&f.push("--target-users",p),Object.keys(s).length>0&&f.push("--filters",JSON.stringify(s));let g=await new Promise((e,t)=>{let r=(0,c.spawn)("python3",f),o="",a="";r.stdout.on("data",e=>{o+=e.toString()}),r.stderr.on("data",e=>{a+=e.toString()}),r.on("close",r=>{0===r?e(o):t(Error(`Python script failed with code ${r}: ${a}`))}),r.on("error",e=>{t(e)})});console.log("Python script output:",g);let b=g.trim().split("\n"),v=b[b.length-1];console.log("Last line from Python output:",v);let D=null,A=null;for(let e=b.length-1;e>=0;e--){let t=b[e].trim();if(t&&(t.startsWith("{")||t.startsWith("[")))try{D=M(t),console.log("Successfully parsed JSON from line:",e+1);break}catch(t){A=t instanceof Error?t.message:"Unknown JSON parse error",console.log(`Failed to parse line ${e+1}:`,t);continue}}if(!D){let e=A?`No valid JSON found in Python output. Last parse error: ${A}`:"No valid JSON found in Python output. Output may contain only non-JSON text.";throw console.error("Python output analysis failed:",{totalLines:b.length,lastLine:v,fullOutput:g.substring(0,500)+(g.length>500?"...":"")}),Error(`${e} Full output: ${g.substring(0,200)}...`)}if("error"===D.status)throw Error(D.message);let O={...D,tempDir:o,filePaths:n,sessionId:r};return console.log(`Storing analysis results for session ${r}`),await w.t.set(r,O),console.log(`Session ${r} stored successfully`),setTimeout(async()=>{try{console.log(`Starting cleanup for session ${r}`);let e=await w.t.get(r);if(e){for(let t of e.filePaths)try{await (0,l.unlink)(t)}catch(e){console.error("Error deleting file:",e)}try{await (0,l.unlink)(e.files.excel)}catch(e){console.error("Error deleting Excel file:",e)}try{await (0,l.unlink)(e.files.html)}catch(e){console.error("Error deleting HTML file:",e)}await w.t.delete(r),console.log(`Session ${r} cleaned up successfully`)}}catch(e){console.error("Cleanup error:",e)}},3e5),i.NextResponse.json({...D,sessionId:r})}catch(e){return console.error("Analysis error:",e),i.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Analysis failed"},{status:500})}}let v=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:"app/api/analyze/route"},resolvedPagePath:"/home/ubuntu/copilot-analysis-web-app/app/app/api/analyze/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:D,staticGenerationAsyncStorage:A,serverHooks:O}=v,P="/api/analyze/route";function $(){return(0,n.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:A})}},9460:(e,t,r)=>{r.d(t,{createTestResults:()=>c,t:()=>l});var o=r(629),a=r(5315),s=r.n(a);class n{constructor(){this.memoryCache=new Map,this.storageDir=s().join(process.cwd(),"temp","sessions")}async ensureStorageDir(){try{await (0,o.access)(this.storageDir)}catch{await (0,o.mkdir)(this.storageDir,{recursive:!0})}}getSessionFilePath(e){return s().join(this.storageDir,`${e}.json`)}async set(e,t){try{await this.ensureStorageDir(),this.memoryCache.set(e,t);let r=this.getSessionFilePath(e);await (0,o.writeFile)(r,JSON.stringify(t,null,2)),console.log(`Session ${e} stored successfully`)}catch(r){console.error(`Failed to store session ${e}:`,r),this.memoryCache.set(e,t)}}async get(e){try{if(this.memoryCache.has(e))return console.log(`Session ${e} found in memory cache`),this.memoryCache.get(e);let t=this.getSessionFilePath(e),r=await (0,o.readFile)(t,"utf-8"),a=JSON.parse(r);return this.memoryCache.set(e,a),console.log(`Session ${e} loaded from file system`),a}catch(t){console.log(`Session ${e} not found:`,t instanceof Error?t.message:"Unknown error");return}}async delete(e){try{this.memoryCache.delete(e);let t=this.getSessionFilePath(e),{unlink:o}=await Promise.resolve().then(r.t.bind(r,629,23));await o(t),console.log(`Session ${e} deleted successfully`)}catch(t){console.error(`Failed to delete session ${e}:`,t)}}keys(){return Array.from(this.memoryCache.keys())}async getAllKeys(){try{await this.ensureStorageDir();let{readdir:e}=await Promise.resolve().then(r.t.bind(r,629,23));return(await e(this.storageDir)).filter(e=>e.endsWith(".json")).map(e=>e.replace(".json",""))}catch(e){return console.error("Failed to get all session keys:",e),this.keys()}}}let i=new n,l={set:async(e,t)=>i.set(e,t),get:async e=>i.get(e),delete:async e=>i.delete(e),keys:()=>i.keys(),getAllKeys:async()=>i.getAllKeys()};function c(){let e="test-session-123",t=[];for(let e=1;e<=45;e++)t.push({email:`user${e}@company.com`,classification:"Top Utilizer",engagementScore:2.5+.5*Math.random(),consistencyPercent:75+25*Math.random(),complexityScore:8+4*Math.random(),avgToolsPerReport:3+2*Math.random(),trend:["Increasing","Stable"][Math.floor(2*Math.random())],appearances:8+Math.floor(4*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,6,Math.floor(9*Math.random())+1).toISOString(),justification:"High Engagement",toolsUsed:["Copilot Chat","Code Completion","Documentation","Debug Assistant"],reportDates:Array.from({length:8+Math.floor(4*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:3+3*Math.random(),complexity:6+4*Math.random()})),riskLevel:"Low"});for(let e=1;e<=70;e++)t.push({email:`under${e}@company.com`,classification:"Under-Utilized",engagementScore:1+1*Math.random(),consistencyPercent:25+35*Math.random(),complexityScore:2+4*Math.random(),avgToolsPerReport:1+2*Math.random(),trend:["Decreasing","Stable"][Math.floor(2*Math.random())],appearances:2+Math.floor(4*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,4,Math.floor(15*Math.random())+1).toISOString(),justification:"Low consistency (active in 3 of 12 months); Downward usage trend",toolsUsed:["Copilot Chat","Code Completion"],reportDates:Array.from({length:2+Math.floor(4*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:2*Math.random(),complexity:3*Math.random()})),riskLevel:"Medium"});for(let e=1;e<=35;e++)t.push({email:`realloc${e}@company.com`,classification:"For Reallocation",engagementScore:.8*Math.random(),consistencyPercent:25*Math.random(),complexityScore:2*Math.random(),avgToolsPerReport:1*Math.random(),trend:["Decreasing","N/A"][Math.floor(2*Math.random())],appearances:1+Math.floor(2*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,1,Math.floor(15*Math.random())+1).toISOString(),justification:"No activity in 90+ days; No tool usage recorded",toolsUsed:[],reportDates:Array.from({length:1+Math.floor(2*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:0,complexity:0})),riskLevel:"High"});let r={status:"success",summary:{total_users:150,top_utilizers:45,under_utilized:70,for_reallocation:35},files:{excel:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183/output/09-July-2025_Copilot_License_Evaluation.xlsx",html:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183/output/leaderboard.html"},sessionId:e,tempDir:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183",filePaths:[],detailed_users:t};return i.set(e,r).catch(console.error),r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972],()=>r(2212));module.exports=o})();