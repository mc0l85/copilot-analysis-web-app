"use strict";(()=>{var e={};e.id=652,e.ids=[652],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},5392:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>D,patchFetch:()=>x,requestAsyncStorage:()=>b,routeModule:()=>S,serverHooks:()=>A,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{POST:()=>w});var o=r(9182),n=r(2007),i=r(6719),s=r(3442),l=r(629);let c=require("child_process");var p=r(5315),u=r.n(p);let d=require("crypto"),m={randomUUID:d.randomUUID},h=new Uint8Array(256),f=h.length,g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));let y=function(e,t,r){if(m.randomUUID&&!t&&!e)return m.randomUUID();let a=(e=e||{}).random??e.rng?.()??(f>h.length-16&&((0,d.randomFillSync)(h),f=0),h.slice(f,f+=16));if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}(a)};var M=r(1440);async function w(e){try{let t=await e.formData(),r=y(),a=u().join(process.cwd(),"temp",r);await (0,l.mkdir)(a,{recursive:!0});let o=t.get("targetUsersFile"),n=JSON.parse(t.get("filters")||"{}"),i=[],p=[],d="";if(o&&o.size>0){let e=Buffer.from(await o.arrayBuffer());d=u().join(a,"target_users.csv"),await (0,l.writeFile)(d,e),i.push(d)}let m=[];for(let[e,r]of t.entries())e.startsWith("usageReportFile_")&&r instanceof File&&m.push(r);for(let e=0;e<m.length;e++){let t=m[e],r=Buffer.from(await t.arrayBuffer()),o=t.name.split(".").pop()||"csv",n=u().join(a,`usage_report_${e}.${o}`);await (0,l.writeFile)(n,r),p.push(n),i.push(n)}let h=u().join(a,"output");await (0,l.mkdir)(h,{recursive:!0});let f=[u().join(process.cwd(),"python_backend","copilot_analyzer.py"),"--usage-reports",...p,"--output-dir",h];d&&f.push("--target-users",d),Object.keys(n).length>0&&f.push("--filters",JSON.stringify(n));let g=(await new Promise((e,t)=>{let r=(0,c.spawn)("python3",f),a="",o="";r.stdout.on("data",e=>{a+=e.toString()}),r.stderr.on("data",e=>{o+=e.toString()}),r.on("close",r=>{0===r?e(a):t(Error(`Python script failed with code ${r}: ${o}`))}),r.on("error",e=>{t(e)})})).trim().split("\n"),w=g[g.length-1],S=JSON.parse(w);if("error"===S.status)throw Error(S.message);return M.t.set(r,{...S,tempDir:a,filePaths:i,sessionId:r}),setTimeout(async()=>{try{let e=M.t.get(r);if(e){for(let t of e.filePaths)try{await (0,l.unlink)(t)}catch(e){console.error("Error deleting file:",e)}try{await (0,l.unlink)(e.files.excel)}catch(e){console.error("Error deleting Excel file:",e)}try{await (0,l.unlink)(e.files.html)}catch(e){console.error("Error deleting HTML file:",e)}M.t.delete(r)}}catch(e){console.error("Cleanup error:",e)}},3e5),s.NextResponse.json({...S,sessionId:r})}catch(e){return console.error("Analysis error:",e),s.NextResponse.json({status:"error",message:e instanceof Error?e.message:"Analysis failed"},{status:500})}}let S=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:"app/api/analyze/route"},resolvedPagePath:"/home/ubuntu/copilot_web_app/app/app/api/analyze/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:b,staticGenerationAsyncStorage:v,serverHooks:A}=S,D="/api/analyze/route";function x(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:v})}},1440:(e,t,r)=>{r.d(t,{createTestResults:()=>o,t:()=>a});let a=new Map;function o(){let e="test-session-123",t=[];for(let e=1;e<=45;e++)t.push({email:`user${e}@company.com`,classification:"Top Utilizer",engagementScore:2.5+.5*Math.random(),consistencyPercent:75+25*Math.random(),complexityScore:8+4*Math.random(),avgToolsPerReport:3+2*Math.random(),trend:["Increasing","Stable"][Math.floor(2*Math.random())],appearances:8+Math.floor(4*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,6,Math.floor(9*Math.random())+1).toISOString(),justification:"High Engagement",toolsUsed:["Copilot Chat","Code Completion","Documentation","Debug Assistant"],reportDates:Array.from({length:8+Math.floor(4*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:3+3*Math.random(),complexity:6+4*Math.random()})),riskLevel:"Low"});for(let e=1;e<=70;e++)t.push({email:`under${e}@company.com`,classification:"Under-Utilized",engagementScore:1+1*Math.random(),consistencyPercent:25+35*Math.random(),complexityScore:2+4*Math.random(),avgToolsPerReport:1+2*Math.random(),trend:["Decreasing","Stable"][Math.floor(2*Math.random())],appearances:2+Math.floor(4*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,4,Math.floor(15*Math.random())+1).toISOString(),justification:"Low consistency (active in 3 of 12 months); Downward usage trend",toolsUsed:["Copilot Chat","Code Completion"],reportDates:Array.from({length:2+Math.floor(4*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:2*Math.random(),complexity:3*Math.random()})),riskLevel:"Medium"});for(let e=1;e<=35;e++)t.push({email:`realloc${e}@company.com`,classification:"For Reallocation",engagementScore:.8*Math.random(),consistencyPercent:25*Math.random(),complexityScore:2*Math.random(),avgToolsPerReport:1*Math.random(),trend:["Decreasing","N/A"][Math.floor(2*Math.random())],appearances:1+Math.floor(2*Math.random()),firstAppearance:new Date(2024,Math.floor(6*Math.random()),1).toISOString(),lastActivity:new Date(2024,1,Math.floor(15*Math.random())+1).toISOString(),justification:"No activity in 90+ days; No tool usage recorded",toolsUsed:[],reportDates:Array.from({length:1+Math.floor(2*Math.random())},(e,t)=>new Date(2024,t,1).toISOString()),monthlyActivity:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map(e=>({month:e,toolsUsed:0,complexity:0})),riskLevel:"High"});let r={status:"success",summary:{total_users:150,top_utilizers:45,under_utilized:70,for_reallocation:35},files:{excel:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183/output/09-July-2025_Copilot_License_Evaluation.xlsx",html:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183/output/leaderboard.html"},sessionId:e,tempDir:"/home/ubuntu/copilot_web_app/app/temp/d49ca207-77b4-40da-9b3c-4cbaaadf6183",filePaths:[],detailed_users:t};return a.set(e,r),r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[372,609],()=>r(5392));module.exports=a})();